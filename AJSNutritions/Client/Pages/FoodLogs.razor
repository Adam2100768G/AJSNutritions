@page "/foodlogs/{id:int}"
@inject IUserService UserService
@inject IFoodLogService FoodLogService
@inject NavigationManager NavigationManager

@if (Id.HasValue)
{
	<PageTitle>Food Logs</PageTitle>
	<h3>Food Logs, For User: @UserName</h3>
}
else
{
	<PageTitle>Invalid User For Food Log</PageTitle>
	<h3>Invalid User for food log</h3>
}

<table class="table">
	<thead>
	<tr>
		<th>Date</th>
		<th></th>
	</tr>
	</thead>
	<tbody>

	@foreach (var foodLog in FoodLogData)
	{
		<tr>
			<td>@foodLog.Date</td>
			<td>
				<button class="btn btn-primary"
				        @onclick="() => ShowFoodLog(foodLog.Id)">
					<i class="oi oi-pencil"></i>
				</button>
			</td>
		</tr>
	}
	</tbody>
</table>
<button class="btn btn-primary"
        @onclick="CreateFoodLog">
	New Food Log
</button>
<button type="button" class="btn btn-secondary" @onclick="BackHome">Return</button>

@code {
	private AJSNutritions.Shared.Domain.User? User { get; set; }
	private List<AJSNutritions.Shared.Domain.FoodLog> FoodLogData { get; set; } = new();
	private string UserName { get; set; } = "unknown user";

	[Parameter] public int? Id { get; set; }

	protected override async Task OnParametersSetAsync()
	{
		if (Id.HasValue)
		{
			var result = await UserService.GetUserById(Id.Value);

			if (result == null)
			{
				return;
			}

			// Assign the user to the User property
			User = result;
			UserName = $"{User.FirstName} {User.LastName}";
			// Get the user's food logs
			FoodLogData = await FoodLogService.GetFoodLogs(User.Id);
		}
	}

	void ShowFoodLog(int id)
	{
		NavigationManager.NavigateTo($"/foodlog/{id}");
	}

	private void CreateFoodLog()
	{
		NavigationManager.NavigateTo($"/test/{User.Id}");
	}
	
	private void BackHome()
	{
		NavigationManager.NavigateTo($"/");
	}

}