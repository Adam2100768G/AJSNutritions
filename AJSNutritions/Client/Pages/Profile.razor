@page "/profile"
@inject IProfileService ProfileService

@using AJSNutritions.Client.Services.ProfileService

<PageTitle>Profile</PageTitle>

<div class="container rounded bg-white mt-5 mb-5">
	<div class="row">
		<div class="col-md-3 border-right">
			<div class="d-flex flex-column align-items-center text-center p-3 py-5"><img class="rounded-circle mt-5" width="150px" src="https://st3.depositphotos.com/15648834/17930/v/600/depositphotos_179308454-stock-illustration-unknown-person-silhouette-glasses-profile.jpg"><span class="font-weight-bold">Full Name</span><span class="text-black-50">@UserName</span><span> </span></div>
		</div>
		<div class="col-md-5 border-right">
			<div class="p-3 py-5">
				<div class="d-flex justify-content-between align-items-center mb-3">
					<h4 class="text-right">Profile Settings</h4>
				</div>
				<div class="row mt-2">
					<EditForm Model="ProfileData" OnSubmit="HandleSubmit">
						<div class="col-md-15">
							<label for="date">Date Of Birth</label>
							<InputDate id="date" @bind-Value="ProfileData.DateOfBirth" class="form-control" />
						</div>
						<div class="col-md-15">
							<label for="height">Height</label>
							<InputNumber id="height" @bind-Value="ProfileData.Height" class="form-control"/>
						</div>
						<div class="col-md-15">
							<label for="weight">Weight</label>
							<InputNumber id="weight" @bind-Value="ProfileData.Weight" class="form-control"/>
						</div>
						<div class="col-md-15">
							<div>@ProfileData.Bmi</div>
						</div>
						<div>
							<label for="genderType">Gender</label>
							<select id="genderType" class="form-control" @bind="@ProfileData.Gender">
								@foreach (var genderType in GenderTypes)
								{
									<option value="@genderType.Id">@genderType.Name</option>
								}
							</select>
						</div>
						<button class="btn btn-primary profile-button" type="submit">Save Profile</button>
					</EditForm>
				</div>
			</div>
		</div>
	</div>
</div>


@code {

	public string? UserName { get; set; }
	public string? Email { get; set; }
	private AJSNutritions.Shared.Profile ProfileData = new AJSNutritions.Shared.Profile { };

	[CascadingParameter] private Task<AuthenticationState>? AuthenticationStateTask { get; set; }

	protected override async Task OnInitializedAsync()
	{
		if (AuthenticationStateTask != null)
		{
			var authState = await AuthenticationStateTask;
			var user = authState.User;

			if (user.Identity is not null && user.Identity.IsAuthenticated)
			{
				UserName = user.Identity.Name;

				AJSNutritions.Shared.Profile res = await ProfileService.GetByUserName(UserName);

				if (res != null)
				{
					ProfileData = res;
				}
			}
		}
	}

	async Task HandleSubmit()
	{
		await ProfileService.Update(UserName, ProfileData);
		AJSNutritions.Shared.Profile res = await ProfileService.GetByUserName(UserName);

		if (res != null)
		{
			ProfileData = res;
		}
	}

	List<GenderType> GenderTypes = new List<GenderType>
	{
		new GenderType(id: 1, name: "Male"),
		new GenderType(id: 2, name: "Female"),
		new GenderType(id: 3, name: "Apache Helicopter"),
		new GenderType(id: 4, name: "Other")
	};

	public class GenderType 	
	{
		public GenderType(int id, string name)
		{
			Id = id;
			Name = name;
		}

		public int Id { get; set; }
		public string Name { get; set; }
	}
}

